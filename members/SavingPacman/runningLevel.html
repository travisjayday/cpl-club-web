<html>

<head>
    <title>Saving Pacman</title>
    <script src='runningLevel_Player.js'></script>
    <script src='runningLevel_Pits.js'></script>
    <script src='runningLevel_midGhosts.js'></script>
    <script src='runningLevel_flyingGhosts.js'></script>
    <script>
        var ctx;
        var keyboard = {};
        var bkgrndX = 0;
        var blob = new Player();
        var pits = [];
        var ghosts = [];
        var flyingGhosts = [];
        var deathCounter = false;
        var sameFrame = false;
        var frameCount = 1;
        var randomGen = Math.floor(Math.random() * (10 - 5) + 5);
        

        //CREATES OBSTACLES
        for (var i = 0; i < 1; i++) {
            ghosts[i] = new midGhost(Math.floor(Math.random() * (1280 - 640) + 640));
            pits[i] = new Pit(Math.floor(Math.random() * (960 - 640) + 640));
            flyingGhosts[i] = new flyingGhost(Math.floor(Math.random() * (3200 - 2560) + 2560));
        }

        //INITIALIZES CANVAS
        function initCanvas() {
            var canvas = document.getElementById('canvas');
            ctx = canvas.getContext('2d');
            setInterval(function () {
                if (ghosts[0].deathCounter || flyingGhosts[0].deathCounter) {
                    deathCounter = true;
                }
            }, 20);
            setInterval(draw, 20);
        }

        //DRAWS
        function draw() {

            if (!deathCounter) {

                //BACKGROUND
                ctx.drawImage(document.getElementById('background'), bkgrndX, 0, 640, 480);
                ctx.drawImage(document.getElementById('background'), bkgrndX + 640, 0, 640, 480);
                bkgrndX -= 2;
                if (bkgrndX + 640 < 0) {
                    bkgrndX = 0;
                }

                //SHOW PLAYER
                blob.show();

                //FLOOR
                ctx.fillStyle = 'brown';
                ctx.fillRect(0, 430, 640, 50);

                //MIDGHOST OBJECTS DISPLAY
                if (!sameFrame == true) {
                    for (var i = 0; i < 1; i++) {
                        if (ghosts.length > 0) {
                            ghosts[i].show();
                            ghosts[i].move();
                            ghosts[i].hits();
                        }

                        if (ghosts[i].x + 75 < 0) {
                            ghosts.pop();
                            for (var i = 0; i < 1; i++) {
                                ghosts[i] = new midGhost((Math.floor(Math.random() * (960 - 640) + 640)))
                                frameCount += 1;
                            }
                        }
                    }
                }

                //PIT OBJECTS DISPLAY
                if (frameCount % randomGen == 0 && frameCount != 0) {
                    sameFrame = true;
                    for (var i = 0; i < 1; i++) {
                        if (pits.length > 0) {
                            pits[i].show();
                            pits[i].move();
                        }

                        if (pits[i].x + 150 < 0) {
                            pits.pop();
                            randomGen = Math.floor(Math.random() * (10 - 5) + 5);
                            sameFrame = false;
                            frameCount = 0;
                            for (var i = 0; i < 1; i++) {
                                pits[i] = new Pit(Math.floor(Math.random() * (960 - 640) + 640));
                            }
                        }
                    }
                }

                //HIGH GHOST OBJECTS DISPLAY
                // for (var i = 0; i < 1; i++) {
                //     if (flyingGhosts.length > 0) {
                //         flyingGhosts[i].show();
                //         flyingGhosts[i].move();
                //         flyingGhosts[i].hits();
                //     }

                //     if (flyingGhosts[i].x + 50 < 0) {
                //         flyingGhosts.pop();
                //         for (var i = 0; i < 1; i++) {
                //             flyingGhosts[i] = new flyingGhost(Math.floor(Math.random() * (3200 - 2560) + 2560));
                //         }
                //     }
                // }

                //PLAYER ACTIONS
                blob.keyboardInput();
                blob.jump();
                blob.squish();
            }
        }

    </script>
</head>

<body onload='initCanvas()'>
    <canvas id='canvas' width='640px' height='480px'></canvas>
    <img hidden src='https://wallpapers.wallhaven.cc/wallpapers/full/wallhaven-442013.png' id='background'>
    <p>Use the 'UP' and 'DOWN' arrow keys ;)</p>
</body>

</html>